<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Comercial Celeiro ‚Äì Pedidos CEASA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="./site/style.css">
  <meta name="theme-color" content="#ffffff">
  <meta name="color-scheme" content="light">
  <meta name="format-detection" content="telephone=no">
  <script
  src="https://unpkg.com/@lottiefiles/dotlottie-wc@0.6.2/dist/dotlottie-wc.js"
  type="module">
</script>
</head>
<body>
  <header class="header">
    <div class="container">
    <div class="brand">
      <img src="site/assets/celeiro-mark.svg" alt="" class="brand-mark" width="28" height="28">
      <h1>Comercial <span class="celeiro">Celeiro</span></h1>
    </div>
      <div class="header-actions">
        <input id="searchInput" type="text" placeholder="Buscar produto..." />
        <select id="categoryFilter" title="Filtrar categoria">
          <option value="todas">Todas</option>
          <option value="Frutas">Frutas</option>
          <option value="Legumes">Legumes</option>
          <option value="Verduras">Verduras</option>
          <option value="Temperos">Temperos</option>
        </select>
        <button id="openCartBtn" class="btn pill">
          <span class="dot"></span>
          <i class="fas fa-shopping-cart"></i> <span id="cartCount">0</span>
        </button>
      </div>
    </div>
  </header>

  <!-- hero / boas-vindas + cadastro -->
  <section class="hero">
    <div class="container small">
      <div class="hero-card">
        <!-- selo pequeno no canto -->
        <img class="hero-mark" src="site/assets/celeiro-mark.svg" alt="" width="44" height="44">


        <div class="hero-text">
          <section id="clientDataForm" class="reveal" aria-labelledby="aboutTitle">
            <div class="about-us">
              <h3 id="aboutTitle">Comercial Celeiro ‚Äì Tradi√ß√£o e Qualidade em Hortifruti</h3>
                <div class="lottie-wrap">
                  <dotlottie-wc
                    src="https://lottie.host/17d73c3a-ddea-45bb-a0e6-bc7c1ca60d0d/YYGjLZ5JUB.lottie"
                    class="lottie"
                    speed="1"
                    autoplay
                    loop
                  ></dotlottie-wc>
              </div>
              <p>
                Desde a <strong>funda√ß√£o do CEASA Barbacena</strong>, o Comercial Celeiro leva frescor e qualidade para dentro da sua casa.
                Localizado no cora√ß√£o do CEASA Barbacena, somos refer√™ncia em hortifr√∫ti completo, oferecendo uma ampla variedade
                de frutas, verduras, legumes, temperos e produtos frescos selecionados com todo cuidado.
              </p>

              <p>
                Nossa miss√£o √© unir tradi√ß√£o, confian√ßa e excel√™ncia no atendimento, garantindo sempre produtos de primeira linha
                para feirantes, restaurantes, mercados e fam√≠lias que prezam pelo melhor da terra.
              </p>

              <p>
                No Comercial Celeiro, voc√™ encontra a combina√ß√£o perfeita entre a experi√™ncia de d√©cadas e a dedica√ß√£o di√°ria
                em oferecer o que h√° de mais fresco e saud√°vel.
              </p>

              <p class="about-sign">
                üåø <strong>Comercial Celeiro</strong> ‚Äì desde a funda√ß√£o do CEASA Barbacena, cultivando confian√ßa e qualidade.
              </p>
            </div>
          </section>
          <ul class="hero-points">
            <li><i class="fas fa-seedling"></i> Atacado e Varejo CEASA ‚Ä¢ Barbacena/MG</li>
            <li><i class="fas fa-road"></i> BR 040 ‚Ä¢ KM 698 ‚Ä¢ CEASA</li>
            <li class="phones">
              <i class="fas fa-phone" aria-hidden="true"></i>
              <a class="tel" href="tel:+55329918505647">(32)&nbsp;32 99185&#8209;0564</a>
              <span class="sep" aria-hidden="true">‚Ä¢</span>
              <a class="tel" href="tel:+553299832505">32 99983&#8209;2505</a>
            </li>
          </ul>
        </div>
      <img class="hero-mark" src="site/assets/celeiro-mark.svg" alt="" width="44" height="44">
    </div>
  </section>
      
  <section class="client">
        <div class="container">
          <form id="clientDataForm" class="client-form" novalidate>
            <div class="row">
              <div class="col">
                <label>Nome completo*</label>
                <input id="clientFullName" type="text" required>
              </div>
              <div class="col">
                <label>CPF ou CNPJ*</label>
                <input id="clientDoc" type="text" inputmode="numeric" required placeholder="somente n√∫meros">
              </div>
            </div>
            <div class="buyer-info" id="deliveryForm">
            <small class="hint" style="margin-bottom:6px;display:block">
              Este √© o <strong>endere√ßo de ENTREGA</strong> (pode ser diferente do endere√ßo da empresa).
            </small>
            <div class="row">
              <div class="col">
                <label>Bairro*</label>
                <input id="addrNeighborhood" type="text" required>
              </div>
              <div class="col">
                <label>Rua / Avenida*</label>
                <input id="addrStreet" type="text" required>
              </div>
              <div class="col col-sm">
                <label>N√∫mero*</label>
                <input id="addrNumber" type="text" inputmode="numeric" required>
              </div>
            </div>
            <div class="row">
              <div class="col">
                <label>Nome de quem ir√° receber*</label>
                <input id="receiverName" type="text" required>
              </div>
              <label style="display:flex; gap:8px; align-items:center; user-select:none; margin-top:4px;">
                <input id="preferTimeChk" type="checkbox" />
                <span>Tenho prefer√™ncia por hor√°rio</span>
              </label>
              <input id="preferTimeInput" type="time" style="display:none;" />
            </div>
            <label for="buyerNotes">Observa√ß√µes</label>
            <textarea id="buyerNotes" rows="4" placeholder="Ex: Deixar na portaria, trocar alface por r√∫cula..." style="width:100%;resize:vertical"></textarea>
          </form>
        </div>
      </section>

  <main class="container">
    <p class="hint"><i class="fas fa-info-circle"></i> Toque em um item para escolher a <strong>varia√ß√£o</strong> (tamanho, embalagem, etc.).</p>
    <section id="catalog" class="grid"></section>
  </main>

  <!-- Drawer do carrinho -->
  <div id="cartDrawer" class="drawer" aria-hidden="true">
    <div class="drawer-content" role="dialog" aria-label="Carrinho">
      <div class="drawer-header">
        <h2><i class="fas fa-shopping-basket"></i> Carrinho</h2>
        <button id="closeCartBtn" class="icon-btn" aria-label="Fechar">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="client-badge" id="clientBadge">Pedido para or√ßamento ‚Ä¢ valores ser√£o enviados pelo WhatsApp</div>
      <div id="cartItems" class="cart-items"></div>

      <div class="cart-footer">
        <div class="totals" id="totalsBox" style="display:none;">
          <div><strong>Itens:</strong> <span id="totalQty">0</span></div>
          <div><strong>Total:</strong> R$ <span id="totalPrice">0,00</span></div>
        </div>

        <button id="checkoutBtn" class="btn primary">
          <i class="fab fa-whatsapp"></i> Enviar pedido para an√°lise
        </button>
        <small class="hint">Os pre√ßos ser√£o calculados e enviados para sua aprova√ß√£o.</small>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container small">
      <p>CEASA ‚Ä¢ Barbacena ‚Ä¢ Minas Gerais</p>
    </div>
  </footer>

  <div id="toast" class="toast"><i class="fas fa-check-circle"></i><span></span></div>

  <!-- Variant Modal -->
  <div id="variantModal" class="modal-backdrop" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="variantTitle">
    <div class="variant-card" role="document" tabindex="-1">
      <div class="variant-head">
        <h3 id="variantTitle">Produto</h3>
        <button id="variantClose" class="icon-btn" aria-label="Fechar op√ß√µes"><i class="fas fa-times"></i></button>
      </div>
      <img id="variantImage" alt="" class="variant-img">
      <p id="variantDesc" class="muted"></p>

      <div id="variantOptions" class="variant-options"></div>

    <div class="variant-qty">
      <label for="variantQty">Quantidade</label>
      <button type="button" class="qty-btn" id="qtyMinus">‚àí</button>
      <input id="variantQty" type="text" inputmode="decimal" value="1">
      <button type="button" class="qty-btn" id="qtyPlus">+</button>
      <small id="variantUnitHint" class="muted"></small>
    </div>

      <button id="variantAddBtn" class="btn primary"><i class="fas fa-plus"></i> Adicionar ao carrinho</button>
    </div>
  </div>

  <!-- scripts originais, sem defer -->
  <script src="site/product.js"></script>
  <script src="site/app.js"></script>
  
  <script>
  (function(){
    const li = Array.from(document.querySelectorAll('.hero-points li'))
      .find(n => n.querySelector('.fa-phone'));
    if (!li) return;

    // se j√° existem links separados, n√£o faz nada
    if (li.querySelectorAll('a.tel').length) return;

    // captura texto ap√≥s o √≠cone
    const icon = li.querySelector('.fa-phone');
    const raw = Array.from(li.childNodes)
      .filter(n => n !== icon && !(n.nodeType === 1 && n.contains(icon)))
      .map(n => n.textContent).join(' ').replace(/\s+/g,' ').trim();

    if (!raw) return;

    // detecta DDD inicial "(dd)" e separa por marcadores comuns
    const dddMatch = raw.match(/\((\d{2})\)/);
    const ddd = dddMatch ? dddMatch[1] : null;
    const rest = raw.replace(/\(\d{2}\)\s*/, '');
    const parts = rest.split(/[‚Ä¢,¬∑]/).map(s => s.trim()).filter(Boolean);

    // limpa li e reconstr√≥i: √≠cone + chips + separadores visuais
    li.innerHTML = ''; li.classList.add('phones'); li.appendChild(icon);
    parts.forEach((txt, i) => {
      const pretty = txt.replace(/-/g, '\u2011'); // h√≠fen inquebr√°vel
      let digits = txt.replace(/\D/g,'');
      if (ddd && (digits.length===8 || digits.length===9)) digits = ddd + digits;
      if (!/^55/.test(digits) && (digits.length===10 || digits.length===11)) digits = '55' + digits;

      const a = document.createElement('a');
      a.className = 'tel';
      a.href = 'tel:+' + digits;
      a.textContent = (i===0 && dddMatch) ? `(${ddd})\u00A0${pretty}` : pretty;
      li.appendChild(a);

      if (i < parts.length - 1) {
        const s = document.createElement('span');
        s.className = 'sep'; s.textContent = '‚Ä¢';
        li.appendChild(s);
      }
    });
  })();
  </script>

  <script>
  (function(){
    // Encontra o <li> com √≠cone de telefone
    const li = Array.from(document.querySelectorAll('.hero-points li'))
      .find(li => li.querySelector('.fa-phone'));
    if (!li) return;

    li.classList.add('phones');

    // Guarda o √≠cone e captura APENAS o texto ao redor, preservando a ordem
    const icon = li.querySelector('.fa-phone');
    const pieces = [];
    li.childNodes.forEach(node=>{
      if (node === icon || (node.nodeType===1 && node.contains(icon))) return; // ignora o √≠cone
      pieces.push(node.textContent || '');
    });
    let raw = pieces.join(' ').replace(/\s+/g,' ').trim();
    if (!raw) return;

    // Extrai DDD inicial, ex: "(32)"
    const dddMatch = raw.match(/\((\d{2})\)/);
    const ddd = dddMatch ? dddMatch[1] : null;
    if (ddd) raw = raw.replace(/\(\d{2}\)\s*/, ''); // remove "(32) " do in√≠cio

    // Divide pelos marcadores comuns (‚Ä¢, v√≠rgula, ponto m√©dio), mantendo a ordem
    const parts = raw.split(/[‚Ä¢,¬∑]/).map(s=>s.trim()).filter(Boolean);

    // Monta chips preservando o texto como est√°, mas com href tel: em E.164
    const chips = parts.map((txt, idx)=>{
      const pretty = txt.replace(/-/g, '\u2011'); // h√≠fen inquebr√°vel na exibi√ß√£o
      let digits = txt.replace(/\D/g,'');         // s√≥ d√≠gitos para o link

      // Se veio sem DDD (8 ou 9 d√≠gitos), usa o DDD inicial
      if (ddd && (digits.length===8 || digits.length===9)) {
        digits = ddd + digits;
      }
      // Brasil: adiciona +55 se faltar
      if (!/^55/.test(digits) && (digits.length===10 || digits.length===11)) {
        digits = '55' + digits;
      }
      return { pretty, href: 'tel:+' + digits };
    });

    // Limpa o <li> e reconstr√≥i: √≠cone (primeiro) + chips (na MESMA ordem)
    li.innerHTML = '';
    li.appendChild(icon);
    chips.forEach(({pretty, href})=>{
      const a = document.createElement('a');
      a.className = 'tel';
      a.href = href;
      a.textContent = pretty;
      li.appendChild(a);
    });
  })();
  </script>

  <script>
  /* Reveal com stagger, incluindo itens adicionados dinamicamente ao #catalog */
  (function(){
    const EASE = 'cubic-bezier(.2,.7,.2,1)';
    const BASE_DELAY = 0.12; // atraso inicial do lote
    const STEP = 0.10;       // espa√ßamento entre itens no lote

    // Garante classe .reveal e prepara transi√ß√µes
    function prep(el){
      if (!el || el.classList.contains('reveal')) return;
      el.classList.add('reveal');
      el.style.transition = `opacity .6s ${EASE}, transform .6s ${EASE}`;
    }

    // Observador de interse√ß√£o com stagger por lote
    const io = new IntersectionObserver((entries)=>{
      // agrupa por pai para aplicar stagger consistente por lote
      const groups = new Map();
      entries.forEach(en=>{
        if (!en.isIntersecting) return;
        const parent = en.target.parentElement || document.body;
        if (!groups.has(parent)) groups.set(parent, []);
        groups.get(parent).push(en.target);
      });

      groups.forEach((items)=>{
        // ordena pelo √≠ndice visual (top/left)
        items.sort((a,b)=> a.getBoundingClientRect().top - b.getBoundingClientRect().top
                        || a.getBoundingClientRect().left - b.getBoundingClientRect().left);
        items.forEach((el, i)=>{
          el.style.transitionDelay = (BASE_DELAY + i*STEP) + 's';
          el.classList.add('is-visible');
          io.unobserve(el);
        });
      });
    }, { threshold: 0.35, rootMargin: '10% 0px -5%' });

    // Prepara e observa elementos est√°ticos
    const hero = document.querySelector('.hero-card');
    const form = document.querySelector('#clientDataForm');
    [hero, form].forEach(el=>{
      if (el){
        prep(el);
        io.observe(el);
      }
    });

    // Lida com o cat√°logo din√¢mico
    const catalog = document.getElementById('catalog');
    if (catalog){
      // j√° existentes (se o app renderizou antes)
      catalog.querySelectorAll('.card').forEach(card=>{
        prep(card); io.observe(card);
      });

      // observa novos n√≥s adicionados ao cat√°logo
      const mo = new MutationObserver((muts)=>{
        // coleta os .card rec√©m-inseridos
        const added = [];
        muts.forEach(m=>{
          m.addedNodes.forEach(node=>{
            if (!(node instanceof HTMLElement)) return;
            if (node.classList && node.classList.contains('card')) {
              added.push(node);
            } else {
              // se veio um fragmento, procura .card dentro
              node.querySelectorAll && node.querySelectorAll('.card').forEach(c=>added.push(c));
            }
          });
        });
        // aplica preparo e observa os novos, com reset de delay
        added.forEach((card, i)=>{
          prep(card);
          // sem delay fixo aqui; o IO define o delay por lote ao entrar na viewport
          card.style.transitionDelay = '';
          io.observe(card);
        });
      });
      mo.observe(catalog, { childList:true, subtree:true });
    }

    // Fallback simples: se o navegador n√£o suportar IO/MutationObserver
    if (!('IntersectionObserver' in window) || !('MutationObserver' in window)) {
      [hero, form].forEach(el=> el && el.classList.add('is-visible'));
      if (catalog){
        catalog.addEventListener('DOMNodeInserted', (e)=>{
          const el = e.target;
          if (el instanceof HTMLElement && el.classList.contains('card')) {
            el.classList.add('is-visible');
          }
        });
      }
    }
  })();
  </script>

  <script>
  (function(){
    // Labels flutuantes robustas no iOS (sem :has)
    const cols = document.querySelectorAll('.client-form .col');
    cols.forEach(col=>{
      const el = col.querySelector('input, textarea');
      if(!el) return;
      // placeholder " " ajuda compat em alguns browsers
      if (!el.hasAttribute('placeholder')) el.setAttribute('placeholder', ' ');
      const sync = () => col.classList.toggle('has-value', (el.value||'').trim().length>0);
      el.addEventListener('focus', ()=> col.classList.add('is-focus'));
      el.addEventListener('blur',  ()=> col.classList.remove('is-focus'));
      el.addEventListener('input', sync);
      sync();
    });
  })();
  </script>

  <script>
  (() => {
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('.btn.primary'); if(!btn) return;
      const r = btn.getBoundingClientRect();
      const span = document.createElement('span');
      span.className = 'ripple';
      span.style.left = (e.clientX - r.left) + 'px';
      span.style.top  = (e.clientY - r.top)  + 'px';
      btn.appendChild(span);
      span.addEventListener('animationend', () => span.remove());
    }, {passive:true});
  })();
  </script>

  <script>
  (() => {
    const el = document.getElementById('cartCount');
    if (!el) return;
    const obs = new MutationObserver(() => {
      el.classList.remove('bump'); void el.offsetWidth; // restart anim
      el.classList.add('bump');
    });
    obs.observe(el, {childList:true, characterData:true, subtree:true});
  })();
  </script>

  <script>
  (function(){
    const fields = document.querySelectorAll('#clientDataForm input, #clientDataForm textarea');
    fields.forEach(el=>{
      // garante placeholder para habilitar estados como :placeholder-shown (se quiser usar no futuro)
      if (!el.hasAttribute('placeholder')) el.setAttribute('placeholder',' ');
      const col = el.closest('.col');
      if (!col) return;
      const sync = () => col.classList.toggle('has-value', (el.value||'').trim().length>0);
      el.addEventListener('input', sync);
      el.addEventListener('blur', sync);
      sync();
    });
  })();
  </script>

  <script>
  (function(){
    const header = document.querySelector('.header');
    if (!header) return;

    // Calcula a altura real do header e aplica no body como --header-h
    function syncHeaderSpace(){
      const h = header.offsetHeight;
      document.documentElement.style.setProperty('--header-h', h + 'px');
    }

    // Encolhe/expande ao rolar
    function onScroll(){
      const y = window.scrollY || document.documentElement.scrollTop;
      if (y > 50) header.classList.add('shrink');
      else header.classList.remove('shrink');
      // altura muda quando shrink toggla ‚Üí ressincroniza
      syncHeaderSpace();
    }

    // Primeira medi√ß√£o ao iniciar
    window.addEventListener('load', syncHeaderSpace);
    // Recalcula em resize/orienta√ß√£o
    window.addEventListener('resize', syncHeaderSpace);
    window.addEventListener('orientationchange', syncHeaderSpace);

    // Scroll listener
    window.addEventListener('scroll', onScroll, { passive: true });

    // Tamb√©m sincroniza depois de um microdelay (fonts/√≠cones podem mudar a altura)
    setTimeout(syncHeaderSpace, 100);
  })();
  </script>

  <script>
  // Bloqueia "double-tap zoom" s√≥ em elementos que N√ÉO s√£o campos de entrada
  (function(){
    let lastTouch = 0;
    const isFormField = (el) => {
      return el.closest('input, textarea, select, [contenteditable="true"]');
    };

    document.addEventListener('touchend', function(e){
      // se tocou num campo de formul√°rio, n√£o bloqueia
      if (isFormField(e.target)) return;

      const now = Date.now();
      if (now - lastTouch <= 300) {
        e.preventDefault();   // cancela o segundo toque
      }
      lastTouch = now;
    }, { passive: false });
  })();
  </script>

  <!-- patch m√≠nimo: blur/foco sem mexer na l√≥gica do seu app -->
  <script>
    (function(){
      const body = document.body;

      // ‚Äî‚Äî‚Äî Drawer (carrinho)
      const drawer = document.getElementById('cartDrawer');
      const openCartBtn = document.getElementById('openCartBtn');
      const closeCartBtn = document.getElementById('closeCartBtn');

      function openCart(){
        if (!drawer) return;
        drawer.classList.add('open');
        drawer.setAttribute('aria-hidden','false');
        body.classList.add('drawer-open'); // aplica blur no <main> via CSS que j√° te passei
      }
      function closeCart(){
        if (!drawer) return;
        drawer.classList.remove('open');
        drawer.setAttribute('aria-hidden','true');
        body.classList.remove('drawer-open');
      }
      openCartBtn && openCartBtn.addEventListener('click', openCart);
      closeCartBtn && closeCartBtn.addEventListener('click', closeCart);
      drawer && drawer.addEventListener('click', e=>{ if (e.target === drawer) closeCart(); });

      // ‚Äî‚Äî‚Äî Modal (varia√ß√µes)
      const modal = document.getElementById('variantModal');
      const modalCard = modal ? modal.querySelector('.variant-card') : null;
      const variantClose = document.getElementById('variantClose');

      // Se o seu app.js j√° controla abrir/fechar adicionando/removendo "open",
      // este c√≥digo s√≥ aplica o blur e acessibilidade:
      const observer = new MutationObserver(() => {
        if (!modal) return;
        const isOpen = modal.classList.contains('open');
        modal.setAttribute('aria-hidden', isOpen ? 'false' : 'true');
        body.classList.toggle('modal-open', isOpen);
        if (isOpen && modalCard) modalCard.focus();
      });
      modal && observer.observe(modal, { attributes:true, attributeFilter:['class'] });

      // Fechar pelo X e clique fora (n√£o interfere se seu app.js j√° fazia)
      function closeVariant(){
        if (!modal) return;
        modal.classList.remove('open');
        modal.setAttribute('aria-hidden','true');
        body.classList.remove('modal-open');
      }
      variantClose && variantClose.addEventListener('click', closeVariant);
      modal && modal.addEventListener('click', e=>{ if (e.target === modal) closeVariant(); });

      // ESC fecha o que estiver aberto
      document.addEventListener('keydown', (e)=>{
        if (e.key !== 'Escape') return;
        if (modal && modal.classList.contains('open')) closeVariant();
        if (drawer && drawer.classList.contains('open')) closeCart();
      });
    })();
  </script>
</body>
</html>
